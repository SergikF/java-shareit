DROP TABLE IF EXISTS bookings;
DROP TABLE IF EXISTS items;
DROP TABLE IF EXISTS item_requests;
DROP TABLE IF EXISTS users;

CREATE TABLE users (
    id LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(50) UNIQUE
);

CREATE TABLE item_requests (
    id LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    description VARCHAR(250),
    requestor LONG NOT NULL REFERENCES users (id) ON DELETE CASCADE ON UPDATE CASCADE,
    created DATETIME DEFAULT (now())
);

CREATE TABLE items (
    id LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(100),
    description VARCHAR(250),
    available BOOL,
    owner LONG NOT NULL REFERENCES users (id) ON DELETE CASCADE ON UPDATE CASCADE,
    request LONG DEFAULT NULL REFERENCES item_requests (id) ON DELETE SET NULL ON UPDATE CASCADE
);

CREATE TABLE bookings (
    id LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    start_ DATETIME,
    end_ DATETIME,
    item LONG NOT NULL REFERENCES items (id) ON DELETE CASCADE ON UPDATE CASCADE,
    booker LONG NOT NULL REFERENCES users (id) ON DELETE CASCADE ON UPDATE CASCADE,
    status VARCHAR(10) DEFAULT 'WAITING'
);

